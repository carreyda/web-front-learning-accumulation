# 浏览器渲染原理

## 什么是渲染

简单来说就是浏览器将 HTML 字符串(HTML、CSS、JavaScript 等代码)转换成用户可见的网页画面(像素信息)的过程。

```js
function render(html) {
  return pixels;
}
```

> 即 代码 → 渲染引擎处理 → 像素 的过程

![GIF 2025-11-13 23-50-18](https://img2024.cnblogs.com/blog/2332774/202511/2332774-20251113235100950-392316403.gif)

## 渲染的时间点

![image](https://img2024.cnblogs.com/blog/2332774/202511/2332774-20251113235322480-319765979.png)

## 浏览器是如何渲染页面的？

当浏览器的网络线程收到 HTML 文档后，会产生一个渲染任务，并将其传递给渲染主线程的消息队列。

在事件循环机制的作用下，渲染主线程取出消息队列中的渲染任务，开启渲染流程。

---

![image](https://img2024.cnblogs.com/blog/2332774/202511/2332774-20251114000222265-2061783273.png)

整个渲染流程分为多个阶段，分别是：HTML 解析、样式计算、布局、分层、绘制、分块、光栅化、画

每个阶段都有明确的输入输出，上一个阶段的输出会成为下一个阶段的输入。

这样，整个渲染流程就形成了一套组织严密的生产流水线。

---

**1.渲染的第一步是`解析HTML`**

解析过程中遇到 CSS 解析 CSS，遇到 JS 执行 JS。为了提高解析效率，浏览器在开始解析前，会启动一个预解析的线程，率先下载 HTML 中的外部 CSS 文件和外部的 JS 文件。

如果主线程解析到 link 位置，此时外部的 CSS 文件还没有下载解析好，主线程不会等待，继续解析后续的
HTML。这是因为下载和解析 CSS 的工作是在预解析线程中进行的。这就是 CSS 不会阻塞 HTML 解析的根本
原因。

如果主线程解析到 SCript 位置，会停止解析 HTML，转而等待 JS 文件下载好，并将全局代码解析执行完成
后，才能继续解析 HTML。这是因为 JS 代码的执行过程可能会修改当前的 DOM 树，所以 DOM 树的生成必须暂停。这就是 JS 会阻塞 HTML 解析的根本原因。

第一步完成后，会得到 DOM 树和 CSSOM 树，浏览器的默认样式、内部样式、外部样式、行内样式均会包含
在 CSSOM 树中。
