# 浏览器渲染原理

## 一、什么是渲染

渲染是浏览器将代码（HTML、CSS、JavaScript）转换成用户可见的网页画面（像素信息）的过程。

```js
function render(html) {
  return pixels;
}
```

**核心流程：** 代码 → 渲染引擎处理 → 像素

![渲染过程演示](https://img2024.cnblogs.com/blog/2332774/202511/2332774-20251113235100950-392316403.gif)

## 二、渲染的时机

![渲染时间点](https://img2024.cnblogs.com/blog/2332774/202511/2332774-20251113235322480-319765979.png)

## 三、浏览器渲染流程

### 3.1 渲染任务的启动

当浏览器网络线程接收到 HTML 文档后，会生成一个渲染任务并传递给**渲染主线程**的消息队列。渲染主线程通过事件循环机制取出任务，开始渲染流程。

### 3.2 渲染流水线

![渲染流水线](https://img2024.cnblogs.com/blog/2332774/202511/2332774-20251114000222265-2061783273.png)

渲染流程包含以下阶段，每个阶段的输出是下一阶段的输入：

1. **HTML 解析**
2. **样式计算**
3. **布局**
4. **分层**
5. **绘制**
6. **分块**
7. **光栅化**
8. **画**

### 3.3 第一步：解析 HTML

![HTML解析流程](https://img2024.cnblogs.com/blog/2332774/202511/2332774-20251125234954099-83662443.png)

#### 预解析机制

为提高解析效率，浏览器启动**预解析线程**，提前下载 HTML 中的外部 CSS 和 JS 文件。

#### CSS 的处理

- 主线程解析到 `<link>` 标签时，**不会等待** CSS 文件下载和解析
- CSS 的下载和解析在预解析线程中并行进行
- **结论：CSS 不会阻塞 HTML 解析**

#### JS 的处理

- 主线程解析到 `<script>` 标签时，**会停止解析** HTML
- 等待 JS 文件下载完成并执行全局代码后，才继续解析
- 原因：JS 可能会修改 DOM 树，必须暂停 DOM 生成
- **结论:JS 会阻塞 HTML 解析**

#### 解析结果

第一步完成后生成两棵树：

- **DOM 树**：文档对象模型
- **CSSOM 树**：包含所有样式（默认样式、内部样式、外部样式、行内样式）

![DOM树和CSSOM树](https://img2024.cnblogs.com/blog/2332774/202511/2332774-20251125235500200-1764643235.png)

![渲染树生成](https://img2024.cnblogs.com/blog/2332774/202511/2332774-20251125235631844-1454155188.png)
